# E2EDrivingAgent PPO Phase D-v3: Fixed Environment + Lane Observation (254D)
# Strategy: Learn lane observation in a FIXED moderate environment (NO curriculum)
# Usage: mlagents-learn python/configs/planning/vehicle_ppo_phase-D-v3.yaml --run-id=phase-D-v3
#
# Phase D v1 Failure: 3 curriculum params advanced simultaneously at 4.68M -> collapse
# Phase D v2 Failure: Staggered thresholds delayed collapse to 7.87M but same failure mode
#   - 350-threshold group (ratio/goal/zones) still advanced 3 params together
#   - Fresh start + noisy lane obs + curriculum = too many simultaneous challenges
#
# Phase D v3 Design Principle (P-009): Don't change observation AND environment simultaneously
#   - NEW observation (254D lane obs) is the ONLY new variable
#   - Environment is FIXED at moderate difficulty (no curriculum at all)
#   - 3 NPCs, moderate speed, 2 zones, 150m goal -> stable baseline
#   - Agent focuses purely on learning to USE lane information
#   - 5M steps (sufficient for single-variable learning)
#
# After D v3 success -> D v4 can add curriculum on top of v3 checkpoint (same 254D)

behaviors:
  E2EDrivingAgent:
    trainer_type: ppo

    hyperparameters:
      batch_size: 4096
      buffer_size: 40960
      learning_rate: 3.0e-4
      beta: 5.0e-3
      epsilon: 0.2
      lambd: 0.95
      num_epoch: 5
      learning_rate_schedule: linear

    network_settings:
      normalize: false
      hidden_units: 512
      num_layers: 3

    reward_signals:
      extrinsic:
        gamma: 0.99
        strength: 1.0

    max_steps: 5000000
    time_horizon: 256
    summary_freq: 10000
    checkpoint_interval: 500000
    keep_checkpoints: 10
    threaded: false

# FIXED environment parameters (NO curriculum)
# Values chosen from Phase C's final stable state
environment_parameters:
  num_active_npcs: 3.0
  npc_speed_ratio: 0.6
  npc_speed_variation: 0.2
  goal_distance: 150.0
  speed_zone_count: 2.0

env_settings:
  env_path: null
  num_envs: 1
  base_port: 5004
  timeout_wait: 600

checkpoint_settings:
  run_id: phase-D-v3
  resume: false
  force: false

engine_settings:
  width: 640
  height: 480
  quality_level: 1
  time_scale: 20
  target_frame_rate: -1
  capture_frame_rate: 60
  no_graphics: false

torch_settings:
  device: cuda
